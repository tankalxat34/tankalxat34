# ПОДГОТОВКА К ЗАЧЕТУ И ТЕСТУ

## ВАЖНАЯ ИНФОРМАЦИЯ

В открытом редакторе кода VBA можно посмотреть список всех компонентов/свойств/функций/методов/событий, которые только есть в этом языке. Для просмотра такой информации нажми `F2` на клавиатуре.

Чтобы посмотреть информацию о виджетах в главном выпадающем списке выбери `"MSForms"` и интерисующий виджет (например `Label`). Обозначения:
- СОБЫТИЕ: ![event](https://raw.githubusercontent.com/tankalxat34/tankalxat34/main/readme_content/event_vba.webp)
- СВОЙСТВО: ![property](https://raw.githubusercontent.com/tankalxat34/tankalxat34/main/readme_content/property_vba.webp)
- МЕТОД: ![method](https://raw.githubusercontent.com/tankalxat34/tankalxat34/main/readme_content/method_vba.webp)


## 1. Дать определения терминам: алгоритм, программа.
**Алгоритм** - точно определённая инструкция, последовательность действий, записанная на человеческом языке, для достижения какой-либо цели путем работы с некоторыми данными.

**Программа** - последовательность действий, составленная на основе некоторого алгоритма и записанная на специальном языке, понятном компьютеру или интерпретатору, которая выполняет определенные задачи путем работы с некоторыми данными.


## 2. Дать определения терминам: Язык программирования, компилятор, интерпретатор.
**Язык программирования** - формальный язык, предназначенный для записи компьютерных программ.

Язык программирования определяет набор лексических, синтаксических и семантических правил, определяющих внешний вид программы и действия, которые выполнит исполнитель (обычно — ЭВМ) под её управлением.

**Компилятор** - программный продукт, преобразующий файлы программ в исполняемые файлы Windows, Linux, macOS или другие операционные системы и интегрируюий в них загрузочный модуль.

**Интерпретатор** - программный продукт, реализующий процесс перевода программы с ЯП на машинные коды.


## 3. Описать свойства и виды алгоритмов
**Свойства алгоритмов:**
- **Дискретность** - путь решения задачи разделен на отдельные шаги
- **Понятность** - алгоритм состоит из команд, входящих в СКИ (*Система команд исполнителя*)
- **Определенность** - команды понимаются однозначно
- **Результативность** - обеспечивается получение ожидаемого результата
- **Массовость** - обеспечивается решение задач с различными исходными данными

**Виды алгоритмов:**
- **Линейный алгоритм** - выполнение команд последовательно
- **Разветвляющийся алгоритм** - выполнение команд зависит от условий и условных конструкций
- **Циклический алгоритм** - выполнение команд может быть зациклено при определенных условиях


## 4. Способы записи алгоритма. Виды алгоритмов.
Основными способами записи алгоритмов являются следующие:
- **словесные** (словесное описание, построчная запись, обычный текст)
- **графические** (блок схемы)
- **на алгоритмических языках** (учебные алгоритмические языки)

**Виды алгоритмов:**
- **Линейный алгоритм** - выполнение команд последовательно
- **Разветвляющийся алгоритм** - выполнение команд зависит от условий и условных конструкций
- **Циклический алгоритм** - выполнение команд может быть зациклено при определенных условиях


## 5. Описать этапы создания программы. Дать определения - объект, метод, событие, свойство.

**ЭТАПЫ РАЗРАБОТКИ ПРОГРАММНОГО ОБЕСПЕЧЕНИЯ:**
1. **Определение проблемы** *(что будет решать программа, в чем будет полезна?)*
2. **Выработка требований** *(подробное описание всех возможностей программы и действий, которые должна выполнять система)*
3. **Создание плана разработки** *(формальном виде составить план разработки программного обеспечения с учётом существующей проблемы и выработанных требований. Иными словами, Вы должны составить план того, как Вы будете действовать дальше)*
4. **Разработка архитектуры системы** *(общее описание системы, основные компоненты, форат и способ хранени данных, специфические бизнес-правила)*
5. **Детальное проектирование** *(На этом этапе проводится проектирование программы на низком уровне, иными словами, здесь проектируются классы и методы, рассматриваются, оцениваются и сравниваются различные варианты и причины выбора окончательных подходов и способов реализации)*
6. **Кодирование и отладка** *(непосредственное написание кода и его отладка - то есть поиск ошибок в работе кода)*
7. **Тестирование компонентов** *(После того, как код написан, и проведена отладка, необходимо провести тестирование реализованного функционала. Если программа состоит из нескольких компонентов, сначала тестируют каждый компонент в отдельности, так как очень крупные программы включают огромный функционал, который часто разделяют на отдельные компоненты, разработка которых осуществляется по отдельности. В менее крупных проектах этот этап может включать просто тестирование отдельных классов)*
8. **Интеграция компонентов** *(процесс интеграции, т.е. слияния всех компонентов в единую систему)*
9. **Тестирование всей системы** *(На данном этапе проводится тестирование всей системы, уже с учётом интеграции всех компонентов)*
10. **Сопровождение, внесение изменений, оптимизация** *(После запуска программы в промышленную эксплуатацию осуществляется сопровождение этой программы, т.е. внесение изменений на основе выявленных недочетов в процессе эксплуатации системы, а также проводится оптимизация функционала или добавление нового)*


**Определения**
- **Объект** - некая сущность, обладающая определенными состояниями и имеющая определенные свойства, атрибуты и методы (Scripting.Dictionary в VBA).
- **Метод** - функция или процедура, принадлежащая какому-либо классу (.Add key, value у экземпляра объекта выше).
- **Событие** - некий триггер, возникающий в программе у определенных объектов при определенных условиях (UserForm1_Initialize или UserForm1_Click).
- **Свойство** - это способ доступа к внутреннему состоянию объекта (TextBox1.Caption).


## 6. Способы запуска редактора VBA. Форма, модуль, окно макета формы, ToolBox, конструктор форм.

Для работы с редактором придется сохранить файл с расширением `.xlsm`

Способы запуска редактора VBA:
1. Alt+F11
2. Лента → Разработчик → Visual Basic
3. Последовательно нажать на русской раскладке: Alt + Ч + А

**Форма** - элемент VBA Excel, который используется для создания программ с графическим интерфейсом.

**Модуль** - элемент VBA Excel, в котором могут находится несколько процедур.

**Окно макета формы** - элемент VBA Excel, в котором пользователь размещает виджеты на пользовательскую форму.

**ToolBox** - элемент VBA Excel, специальное окно с различными виджетами, которые могут быть размещены на пользовательской форме.

**Конструктор форм** - совокупность средств создания пользовательских форм и их программирования

## 7. Окно редактора VBA

Окно редактора VBA представляет из себя обычное окно Windows, которое можно сворачивать в панель задач, разворачивать на весь экран и закрывать.

В названии окна написано "Microsoft Visual Basic for Applications - {НазваниеКниги} - {НазваниеОткрытогоКомпонента} ({ПросматриваемоеПространствоКомпонентаПроекта})"

**НазваниеОткрытогоКомпонента** - Имя пользовательской формы или модуля

**ПросматриваемоеПространствоКомпонентаПроекта** - Обычно равно Code или UserForm в зависимости от того, что сейчас пользователь просматривает - исходный код, или внешний вид пользовательской формы в конструкторе форм.

По умолчанию вверху окна находится menubar со вкладками для работы с файлом, кодом, модулями и формами и т.д.

На следующем Menubar находятся быстрые команды для открытия Excel, вставки модуля, класса или пользовательской формы, сохранения файла, копирования/вставки, запуска макроса, его остановки и постановки на паузу и т.д.

В окне редактора VBA могут отображаться следующие окна:
- **Project** - показывает содержимое проектов всех открытых в данный момент книг со всеми модулями, формами и классами-модулей
- **Properties** - окно редактора свойств. Особенно полезно при создании форм
- **Immediate** - окно для предварительного выполнения кода. После написания строки с кодом и нажатия Enter написанная строчка выполняется.
- **Locals** - окно для отслеживания значений локальных переменных (слежка за конкретной переменной в активной процедуре активного модуля книги)
- **Watches** - окно для отслеживания значений любых переменных или выражений в любой процедуре в любом модуле. В отличие от предыдущего сюда необходимо вручную добавить необходимую переменную и настроить ее область видимости.
- **Object Browser** - окно для просмотра всех свойств, методов, состояний любых объектов, классов, сущностей, констант и многого другого в языке программирования VBA. Есть возможность поиска по данной базе. Если хорошо знаешь английский - без труда догадаешься, что каждая надпись может означать.

Команды на описанных menubar можно комбинировать и переставлять. Само окно, где отображается код, можно настроить - выбрать шрифт, размер шрифта, а так же отдельно указать для каждой сущности ее цвет в коде.


## 8. Объект UserForm: основные свойства, методы, события

### Свойства

|  Свойство  |                         Описание                          |     По умолчанию     | Тип данных |
|------------|-----------------------------------------------------------|----------------------|------------|
| Name       | Имя формы в коде                                          | UserForm1            |            |
| Caption    | Название окна формы                                       | UserForm1            | String     |
| Enabled    | Доступна ли форма для клика?                              | True                 | Boolean    |
| ShowModal  | Доступен ли лист при открытой форме?                      | False                | Boolean    |
| Font       | Все, что связано со шрифтом в ПФ: название, размер, стиль |                      |            |
| BackColor  | Цвет фона ПФ                                              | ButtonFace           | Const      |
| ScrollBars | Какие полосы прокрутки отображать в форме?                | 0 - fmScrollBarsNone | Const      |
| Picture    | Путь к картинке, которая будет установлена как фон        | None                 | String     |


#### Примеры

Код ниже при каждом нажатии на кнопку CommandButton1 добавляет к началу и концу названия формы звездочки:
```vb
Private Sub CommandButton1_Click()
    UserForm1.Caption = "*" + UserForm1.Caption + "*"
End Sub
```

### Методы


|     Метод     |                                                       Описание                                                        |                                              Параметры                                              |
|---------------|-----------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Hide          | Скрывает объект, не выгружая его из памяти                                                                            |                                                                                                     |
| PrintForm     | Отправляет по кусочкам изображение объекта ПФ на принтер                                                              |                                                                                                     |
| Show          | Открыть/показать ПФ                                                                                                   | Определение модальности окна: vbModal (лист не будет доступен) или vbModeless (лист будет доступен) |
| WhatsThisMode | Вызывает изменение указателя мыши на указатель Что это и готовит приложение к выводу справки для выделенного объекта. |                                                                                                     |

#### Примеры

Код ниже открывает ПФ:
```vb
Sub main()
    UserForm1.Show
End Sub
```

### События


|  Событие   |                          Описание                           |
|------------|-------------------------------------------------------------|
| Initialize | Открытие формы                                              |
| QueryClose | Закрытие формы                                              |
| Click      | Клик на форме                                               |
| DblClick   | Двойной клик на форме                                       |
| Activate   | Активация формы                                             |
| Deactivate | Снятие фокуса с формы, ее деактивация                       |
| MouseUp    | Возникает, когда пользователь отжимает кнопку мыши на форме |

Примеры:

```vb
Private Sub UserForm_Click()
    MsgBox("вы кликнули по форме")
End Sub

Private Sub UserForm_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    MsgBox("вы отжали правую или левую кнопку мыши")
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    MsgBox("вы закрываете форму")
End Sub

```

## 9. Элементы управления. Общие сведения. Label, CommandButton, ToggleButton. Свойства, методы, события.

**Элементы управления** - это специальные виджеты, которые могут быть размещены на пользовательской форме. Специальное меню, откуда можно перетаскивать виджеты на форму в конструкторе форм, называется Toolbox.

Количество элементов управления в toolbox может быть увеличено - нужно нажать правую кнопку мыши, выбрать пункт **"Additional Controls..."** и в открывшемся окне выбрать галочками необходимые виджеты.

### Label

#### Свойства

- **Caption** - текст в надписи
- **BackColor** - цвет фона надписи
- **Font** - все, что связано со шрифтом
- **TextAligin** - ориентация текста в надписи (слева, по центру, справа)

Пример:
```vb
Sub Label_Properties()
    'установка текста
    Label1.Caption = "Новый текст"

    ' установка красного фона
    Label1.BackColor = vbRed

    ' ориентация текста по центру
    Label1.TextAlign = 2
End Sub
```

#### Методы

Объект не имеет методов

#### События
- **MouseMove** - движение курсором над надписью
- 


### CommandButton

#### Свойства
- **Caption** - текст на кнопке
- **BackColor** - цвет фона кнопки
- **ForeColor** - цвет шрифта
- **WordWrap** - True, если нужен перенос по словам
- **Width** - ширина кнопки в пикселях

Пример:
```vb
Sub main()
    'новый текст
    CommandButton1.Caption = "Новый текст на кнопке"

    'ярко-бирюзовый фон
    CommandButton1.BackColor = vbBlue

    'белый цвет шрифта
    CommandButton1.ForeColor = vbWhite

    'включить перенос по словам
    CommandButton1.WordWrap = True

    'ширина кнопки в пикселях
    CommandButton1.Width = 50
End Sub
```

#### Методы

Объект не имеет методов

### ToggleButton

...

# Теперь вопросы пойдут с конца, так как там самые сложные и интересные

## 40. Импорт данных из листа Excel в шаблон документа Word с помощью VBA

В Word'е делаешь закладку (вставка - закладка) там где необходимо импортировать фамилию, называешь её как хочешь. К примеру пусть будет zakladka. Далее кнопка или макрос решать вам.

```vb
Dim wda As Object
Dim wda1 As Object
Dim wda2 As Object
Dim wda3 As Object
Dim wda4 As Object

Set wda = CreateObject("Word.Application")
With wda
    .Visible = True
    .Documents.Open "C:\Users\Admin\test.docx"
    .ActiveDocument.Bookmarks("zakladka").Select
End With

Worksheets("Лист").Activate
Range("A2:E60").SpecialCells(xlCellTypeConstants).Copy
' либо сделать так:
' Cells.SpecialCells(xlCellTypeConstants).Copy
wda.Selection.Paste
```

## 39. Объектная модель Word. Способы обращения к объектам MSWord

Схема из [официального источника](https://docs.microsoft.com/ru-ru/visualstudio/vsto/word-object-model-overview?view=vs-2019&tabs=csharp):

![img](https://docs.microsoft.com/ru-ru/visualstudio/vsto/media/wrwordobjectmodel.gif?view=vs-2019)

### Работа с активным документом

Типичная VBA-процедура в Word выполняет все свои магические действия в том документе, который в данный момент открыт для редактирования. Для указания активного документа используется объект ActiveDocument. Например, приведенная выше инструкция просто закрывает активный документ:


```vb
ActiveDocument.Close
```

Как видите, вам не нужно писать код для определения того, какой же документ редактируется в данный момент: достаточно просто использовать объект ActiveDocument.

Если вам необходимо работать с определенным документом, который сейчас не активен, вы должны указать его как члена коллекции Documents, состоящей изо всех документов, открытых в настоящее время в Word. Как и в случае с любой другой коллекцией объектов в VBA, вы можете обратиться к отдельному документу в коллекции, используя его заголовок, который в данном случае совпадает с именем файла (только именем файла, а не с полным путем к нему). Вот соответствующий пример;

```vb
Documents("Toy Store News letter.doc")
```

Поскольку вы не знаете точно имя файла целевого документа заранее, а пользователь может в любой момент его изменить, вам следует создать переменную, которая будет содержать имя файла. После этого вы можете использовать эту переменную для указания объекта документа, например, так: Documents (strDocName).

Вы также можете обратиться к документу по его индексному номеру. Следующая инструкция, например, обращается к третьему документу в коллекции Documents:

```vb
Documents(3)
```

Несмотря на всю простоту, этот метод достаточно ограничен, поскольку вы редко когда знаете индексный номер документа, с которым хотите работать. При этом вам стоит узнать имя открытого документа. Например, следующая инструкция присваивает переменной имя файла второго открытого документа:

```vb
strDocName = Documents(2).Name
```

Для создания нового документа используйте метод `Add` коллекции объектов Documents. Используемый без каких-либо документов, метод `Add` создает новый документ, базирующийся на шаблоне Normal (Обычный). Для указания другого шаблона укажите путь к нему в качестве аргумента, как показано ниже:

```vb
Documents.Add template:= _

"C:WindowsApplication DataXMicrosoftHidden templates"
```

Для открытия существующего документа используйте метод Open коллекции объектов Documents. Конечно же, вам необходимо указать полный путь к документу, как показано ниже:

```vb
Documents.Open FileName:= _

"С:ToysToys for infants.doc"
```


Для активизации уже открытого документа используйте метод Activate коллекции объектов Documents. Предположим, что вам необходимо, чтобы ваша VBA-программа активизировала определенный документ, который в момент запуска программы может быть и открыт, и закрыт. Используйте код, подобный показанному ниже, для активизации открытого документа или открытия документа, если он еще не открыт:

```vb
Sub DocActivateOrOpen()

    Dim docFileName As String, docPath as String
    docFileName = "Старые игрушки.doc"
    docPath = "C:Toys"

    For Each target Doc In Documents
        If targetDoc.Name = docFileName Then
            targetDocIsOpen = True
        End If
    Next targetDoc

    If targetDocIsOpen = True Then
        Documents(docFileName).Activate
    Else
        Documents.Open FileName := docPath & docFileName
    End If

End Sub
```

Поскольку каждый документ Word состоит из одного или нескольких разделов, вы можете ожидать, что Word VBA содержит коллекцию Sections и отдельные объекты Section для работы с этими элементами. Так оно и есть. Наиболее важное применение объектов Section - организация доступа к верхним и нижним колонтитулам (через объект Header Footer ). Вы можете добавлять новые разделы в документ, используя метод Add коллекции Sections или метод Insert Break объекта Range или Selection.

## 38. Работа с диаграммами на форме. Создание, добавление на форму через импорт-экспорт

Импорт диаграммы в форму:

```vb
Private Sub CommandButton1_Click()
    ' отключаем обработку ошибок
    On Error Resume Next
    ' экспортируем диаграмму как картинку по заданному пути
    ActiveChart.Export Filename:= ThisWorkbook.Path & Application.PathSeparator & "temp.jpeg"
    ' загружаем картинку-диаграмму в виджет на пользовательской форме
    Image1.Picture = LoadPicture(ThisWorkbook.Path & Application.PathSeparator & "temp.jpeg")
End Sub
```

Очистка виджета для картинки

```vb
Private Sub CommandButton2_Click()
    ' очищает виджет для картинки
    Image1.Picture = LoadPicture(vbNullString)
    ' и удаляет старую картинку
    If Dir(ThisWorkbook.Path & Application.PathSeparator & "temp.jpeg") <> "" Then Kill ThisWorkbook.Path & Application.PathSeparator & "temp.jpeg"
End Sub
```

## 37. Отладка программ. Режимы использования отладчика. Специализированные окна отладчика.

**Отладка программ** - процесс поиска ошибок работы в написанной программе с помощью встроенных в редактор кода инструментов.

**Точка останова** - некая точка, устанавливаемая программистом, дойдя до которой программа остановится и будет ожидать продолжения работы.

Строка с маркером, на котором остановилась программа, будет выполнена после очередного нажатия кнопки Run Macro или клавиши F5.

Окна для работы с отладчиком:
- **Locals** - окно для отслеживания значений локальных переменных (слежка за конкретной переменной в активной процедуре активного модуля книги)
- **Watches** - окно для отслеживания значений любых переменных или выражений в любой процедуре в любом модуле. В отличие от предыдущего сюда необходимо вручную добавить необходимую переменную и настроить ее область видимости.

## 36. Перехват ошибок. Обработчик ошибок. Типы ошибок.

`On Error` – это оператор, который используется для отслеживания ошибок во время исполнения кода VBA. При возникновении ошибки On Error передает информацию о ней в объект Err и включает программу обработки ошибок, начинающуюся с указанной строки.

Оператор перехвата ошибок:

```vb
On Error GoTo Stroka
```

Строка, с которой начнется выполнение:

```vb
Stroka:
```

### Синтаксис

#### Первый случай
```vb
On Error GoTo Stroka
```
Включает алгоритм обнаружения ошибок и, в случае возникновения ошибки, передает управление операторам обработчика ошибок с указанной в выражении строки. Stroka – это метка, после которой расположены операторы обработчика ошибок.

#### Второй случай
```vb
On Error Resume Next
```
Включает алгоритм обнаружения ошибок и, в случае возникновения ошибки, передает управление оператору, следующему за оператором, вызвавшем ошибку.

#### Третий случай
```vb
On Error GoTo 0
```
Отключает любой включенный обработчик ошибок в текущей процедуре.

#### Вывод описания ошибки
```vb
MsgBox "Возника ошибка: " & Err.Description
```

## 35. Использование встроенных функций Excel. 

После введения `WorksheetFunction`, появится список функций. Выбираем нужную и работаем с ней.

## 34. Способы обращения к объектам Excel: к листам, к диапазонам и ячейкам.

### Ячейки и листы

Полный путь:

```vb
Workbooks("Книга2.xlsm").Sheets("Лист2").Range("C5")
Workbooks("Книга2.xlsm").Sheets("Лист2").Cells(5, 3)
Workbooks("Книга2.xlsm").Sheets("Лист2").Cells(5, "C")
Workbooks("Книга2.xlsm").Sheets("Лист2").[C5]

ActiveSheet.Range("A1")
ActiveWorkbook.Worksheets ' список листов активной книги
```

Укороченная запись:
```vb
ActiveCell
Range("A1")
Range("Итого")
Cells(1, 1)
Cells(1, "A")
[A1]

'так выглядит запись слова Test в ячейку А1
Range("A1").Select
Selection.Value = "Test"
```

### Диапазоны

```vb
Range("A1:B10").Select

' Так можно выделить ячейку в 3 строке и 2 столбце диапазона "D5:F56"
Range("D5:F56").Cells(3, 2).Select
```

## 33. Объектная модель Excel. Основные свойства, методы и события объекта WorkSheet.

